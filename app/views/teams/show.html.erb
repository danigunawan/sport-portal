<%- model_class = Team -%>
<%= stylesheet_link_tag 'teams' %>

<script type="text/javascript">
    function checkAll(check) {
        var cbxs = $('input[type="checkbox"]');
        cbxs.prop("checked", check);
    }
    function sendMailToMultipleMembers() {
        var email_adresses = [];
        $('table tr').filter(':has(:checkbox:checked)').each(function() {
            email_adresses.push($(this).find('a[href^="mailto:"]')[0].pathname);
        });
        if (email_adresses.length > 0) {
            window.location.href = 'mailto:' + email_adresses.join();
        }
    }
</script>

<div id="teamProfile">
  <div class="container">
    <div class="row" style="padding-top: 10vh;">
      <div class="col s12 center">
        <%= image_tag @team.avatar_url || image_path('https://owncloud.hpi.de/index.php/s/8gBDPW6Wze8w65U/download'), id: 'teamProfileImage'%>
      </div>
    </div>
    <div class="row">
      <div class="col s12 center">
        <h1><%= @team.name %></h1>
      </div>
    </div>
    <div class="row">
      <div class="col s10 offset-s1">
        <p class="center white-text"><%= @team.description %></p>
      </div>
    </div>
    <div class="row">
      <div class="col s12 center">
        <% if user_signed_in? && (@team.members.include? current_user) %>
            <% if can? :delete_membership, @team, current_user.id %>
                <%= link_to t('.delete_membership', :default => t("helpers.links.leave_team")),
                            delete_membership_team_path(@team, :team_member => current_user.id),
                            :method => 'post',
                            :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm_leave_team"))},
                            :class => 'btn-danger genericButton',
                            :id => 'membershipButton'
                %>
            <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
<div style="clear: both"></div>

<div class="container">
  <section id="kindOfSportsSection">
    <div class="row">
      <div class="col s12 center">
        <h2><%=t '.kind_of_sport', :default => t("helpers.teams.kind_of_sport") %></h2>
      </div>
    </div>
    <div class="row">
      <div id="kindOfSports" class="col s12 center">
        <%= @team.kind_of_sport %>
      </div>
    </div>
  </section>
  <section id="participantsSection">
    <%= form_tag perform_action_on_multiple_members_team_path(@team) do %>
      <div class="row">
        <div class="col s12 center">
          <h2><%= t('events.show.participants') %></h2>
        </div>
      </div>
      <div class="row hide-on-small-only">
        <div class="col s12">
          <% if can? :assign_membership_by_email, @team %>
            <%= link_to t('teams.show.invite_user_to_team'),
                        '#',
                        data: {'toggle': 'modal', 'target': '#invite_user_by_email_modal'},
                        class: 'genericButton blueActionButton' %>

            <%= render :partial => 'invite_user_by_email_modal' %>
          <% end %>
        </div>
      </div>
      <% @team.members.each_with_index do | member, iMember | %>
        <% if (iMember % 2) == 0 %>
          <div class="row">
        <% end %>
        <div class="col s12 m6 participant">
          <div class="row valign-wrapper" style="height: 100%;">
            <div class="col s2 valign-wrapper" style="padding-top: 10px;">
              <% if @team.members.include? current_user %>
                  <%= check_box_tag "members[]", member.id, false, class: 'filled-in' %>
                  <%= label_tag  "members[]", member.id do %><% end %>
              <% end %>
            </div>
            <div class="col s2">
              <%= (image_tag member.avatar_url || 'https://owncloud.hpi.de/index.php/s/rd14acG6qOlAHHJ/download') %>
            </div>
            <div class="col s6 truncate" style="font-size: 120%;">
              <%= member.first_name %> <%= member.last_name %>
            </div>
            <div class="col s2">
              <% if can? :send_emails_to_team_members, @team %>
                  <%= mail_to member.email do %>
                      <img src="https://owncloud.hpi.de/index.php/s/OEnLDLBOBktpqzT/download">
                  <% end %>
              <% end %>
            </div>
          </div>
        </div>
        <% if (iMember % 2) == 1 || iMember == @team.members.length - 1 %>
          </div>
        <% end %>
      <% end %>
      <div class="row">
        <div class="col s6 m12">
          <button type="button" onclick="checkAll(true);" class="genericButton whiteActionButton">
            <%=t('.select_all', :default => t("helpers.teams.multiple_actions.select_all"))%>
          </button>
          <button type="button" onclick="checkAll(false);" style="margin-left: 10px;" class="genericButton whiteActionButton hide-on-small-only">
            <%=t('.deselect_all', :default => t("helpers.teams.multiple_actions.deselect_all"))%>
          </button>
        </div>
        <div class="col s6 hide-on-med-and-up center">
          <button type="button" onclick="checkAll(false);" style="margin-left: 10px;" class="genericButton whiteActionButton">
            <%=t('.deselect_all', :default => t("helpers.teams.multiple_actions.deselect_all"))%>
          </button>
        </div>
      </div>
      <div class="row" style="margin-top: 50px;">
        <div class="col s12" style="font-size: 80%;">
          <%= t('.apply_action', :default => t("helpers.teams.multiple_actions.apply_action")) %>
        </div>
      </div>
      <div class="row">
        <% if @team.members.include? current_user %>

        <% end %>
      </div>
    <% end %>
  </section>
  <div class="row">
    <div class="col s10 offset-s1">
      <div class="divider"></div>
    </div>
  </div>
  <section>
    <div class="row">
      <div class="col m12 hide-on-small-only">
        <% if can? :edit, @team %>
            <%= link_to t('.edit', :default => t("helpers.links.edit")),
                        edit_team_path(@team), :class => 'genericButton grey darken-1' %>
        <% end %>
        <% if can? :destroy, @team %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        team_path(@team),
                        :method => 'delete',
                        :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm"))},
                        :class => 'btn-danger genericButton red',
                        :style => 'margin-left: 20px;' %>
        <% end %>
      </div>
      <div class="col s12 center hide-on-med-and-up">
        <% if can? :edit, @team %>
            <%= link_to t('.edit', :default => t("helpers.links.edit")),
                        edit_team_path(@team), :class => 'genericButton grey darken-1' %>
        <% end %>
      </div>
    </div>
    <div class="row hide-on-med-and-up">
      <div class="col s12 center">
        <% if can? :destroy, @team %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        team_path(@team),
                        :method => 'delete',
                        :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm"))},
                        :class => 'btn-danger genericButton red' %>
        <% end %>
      </div>
    </div>
  </section>
</div>